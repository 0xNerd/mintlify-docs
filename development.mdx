---
title: 'Development'
description: 'How we build, test, and operate the ZK Send bot'
---

<Info>
  **Stack** · Node.js 20 · TypeScript · Telegraf · Supabase · Privy · Privacy Cash SDK
</Info>

## Local workflow

<Steps>
<Step title="Install dependencies">

```bash
npm install
```

</Step>
<Step title="Start the dev bot">

```bash
npm run dev
```

Uses `ts-node-dev` to watch `src/**` and restart on change. The bot defaults to long polling locally; set `WEBHOOK_URL` to test webhook mode.

</Step>
<Step title="Run the SDK + bot build">

```bash
npm run build:sdk && npm run build
```

Builds the Privacy Cash SDK artifacts followed by the production bot bundle in `dist/`.

</Step>
</Steps>

## Environment files

| File | Purpose |
| ---- | ------- |
| `.env` | Local development secrets, never committed |
| `.env.production` | Optional file mounted in CI/CD for production deploys |
| `env.example` | Source of truth for required keys + inline descriptions |

Use `scripts/check-env.ts` (run via `npm run env:check`) to assert that required keys exist before deploy.

## Database + migrations

1. Update `src/database/schema.sql` when schema changes.
2. Run `npm run db:push` to apply the SQL locally via Supabase CLI or `psql`.
3. Commit both the SQL diff and any generated TypeScript types (if using `npm run types:generate`).

<Warning>
  Enable Row Level Security (RLS) and service role separation before shipping new tables.
</Warning>

## Testing + QA

| Command | Description |
| ------- | ----------- |
| `npm test` | Unit tests for services, middleware, and helper utilities |
| `npm run lint` | ESLint + TypeScript checks |
| `npm run typecheck` | Standalone `tsc --noEmit` for CI |
| `npm run qa` | Spins up the bot against a staging Supabase/Privy project and runs smoke scripts |

<Note>
  Telegram-specific flows are validated with Playwright scripts in `tests/e2e`. They rely on a seeded staging account and are skipped locally unless `E2E=true`.
</Note>

## Logging + monitoring

- **Structured logs**: `pino` emits JSON logs with request IDs and command metadata.
- **Supabase audit tables**: `wallet_activity`, `private_transfers`, and `errors` tables capture every state change.
- **Alerts**: Use the provided Grafana dashboard JSON in `ops/grafana.json` to wire alerts for stuck transfers or error spikes.

Set `LOG_PRETTY=true` for human-readable logs during development.

## Background jobs

- `jobs/cleanup.ts` prunes expired Privacy Cash notes.
- `jobs/retry-transfers.ts` retries stuck withdrawals.
- Schedule both via `npm run cron` or hook them into your orchestration platform (Temporal, Cloud Scheduler, etc.).

Each job can also be invoked manually:

```bash
npm run job cleanup
npm run job retry-transfers -- --limit=20
```

## Release checklist

1. `npm run lint && npm run typecheck`
2. `npm run test`
3. `npm run build`
4. `npm run qa` (staging smoke)
5. Tag release and deploy via your chosen runner (Railway, Fly.io, etc.)
6. Rotate any credentials that were re-issued during the release (Supabase keys, Privy secrets)

<AccordionGroup>
  <Accordion title="Troubleshooting Telegram webhooks">
    - Verify the public HTTPS endpoint matches `WEBHOOK_URL`.
    - Ensure the bot certificate is valid if you provide one.
    - Run `npm run webhook:test` to send a sample update payload.
  </Accordion>
  <Accordion title="Common Privacy Cash issues">
    - Rebuild the SDK if typings drift: `npm run build:sdk`.
    - Confirm the API key scope includes `transfer` + `withdraw`.
  </Accordion>
</AccordionGroup>
